[webserver]
# Generated via server/tegola/generate-config.js. Do not edit by hand.
bind = "{{TEGOLA_BIND}}"
uri = "{{TEGOLA_PUBLIC_URL}}"

[cache]
type = "file"
filename = "{{TEGOLA_CACHE_FILE}}"
max_features = {{TEGOLA_CACHE_MAX_FEATURES}}

[[providers]]
name = "questables"
type = "mvt_postgis"

  [providers.postgis]
  host = "{{DATABASE_HOST}}"
  port = {{DATABASE_PORT}}
  database = "{{DATABASE_NAME}}"
  user = "{{DATABASE_USER}}"
  password = "{{DATABASE_PASSWORD}}"
  srid = 0
  sslmode = "{{DATABASE_SSLMODE}}"
  max_connections = {{DATABASE_MAX_CONNECTIONS}}

  [[providers.layers]]
  name = "world_cells"
  geometry_fieldname = "geom"
  id_fieldname = "id"
  geometry_type = "Polygon"
  srid = 0
  sql = """
    SELECT id,
           world_id,
           cell_id,
           biome,
           state,
           culture,
           religion,
           population,
           height,
           geom
      FROM maps_cells
     WHERE geom && !BBOX!
       AND world_id IN (SELECT id FROM maps_world WHERE is_active = true)
  """

  [[providers.layers]]
  name = "world_routes"
  geometry_fieldname = "geom"
  id_fieldname = "id"
  geometry_type = "LineString"
  srid = 0
  sql = """
    SELECT id,
           world_id,
           route_id,
           name,
           type,
           feature,
           geom
      FROM maps_routes
     WHERE geom && !BBOX!
       AND world_id IN (SELECT id FROM maps_world WHERE is_active = true)
  """

  [[providers.layers]]
  name = "world_rivers"
  geometry_fieldname = "geom"
  id_fieldname = "id"
  geometry_type = "LineString"
  srid = 0
  sql = """
    SELECT id,
           world_id,
           river_id,
           name,
           type,
           discharge,
           width,
           geom
      FROM maps_rivers
     WHERE geom && !BBOX!
       AND world_id IN (SELECT id FROM maps_world WHERE is_active = true)
  """

  [[providers.layers]]
  name = "world_markers"
  geometry_fieldname = "geom"
  id_fieldname = "id"
  geometry_type = "Point"
  srid = 0
  sql = """
    SELECT id,
           world_id,
           marker_id,
           type,
           icon,
           note,
           geom
      FROM maps_markers
     WHERE geom && !BBOX!
       AND world_id IN (SELECT id FROM maps_world WHERE is_active = true)
  """

  [[providers.layers]]
  name = "world_burgs"
  geometry_fieldname = "geom"
  id_fieldname = "id"
  geometry_type = "Point"
  srid = 0
  sql = """
    SELECT id,
           world_id,
           burg_id,
           name,
           population,
           capital,
           geom
      FROM maps_burgs
     WHERE geom && !BBOX!
       AND world_id IN (SELECT id FROM maps_world WHERE is_active = true)
  """

  [[providers.layers]]
  name = "campaign_spawns"
  geometry_fieldname = "world_position"
  id_fieldname = "id"
  geometry_type = "Point"
  srid = 0
  sql = """
    SELECT id,
           campaign_id,
           name,
           note,
           is_default,
           world_position
      FROM campaign_spawns
     WHERE world_position IS NOT NULL
       AND world_position && !BBOX!
  """

  [[providers.layers]]
  name = "campaign_locations"
  geometry_fieldname = "world_position"
  id_fieldname = "id"
  geometry_type = "Point"
  srid = 0
  sql = """
    SELECT id,
           campaign_id,
           name,
           type,
           is_discovered,
           world_position
      FROM locations
     WHERE world_position IS NOT NULL
       AND world_position && !BBOX!
  """

  [[providers.layers]]
  name = "campaign_objectives"
  geometry_fieldname = "geom"
  id_fieldname = "objective_id"
  geometry_type = "Point"
  srid = 0
  sql = """
    SELECT objective_id,
           campaign_id,
           title,
           is_major,
           order_index,
           geom
      FROM v_campaign_objective_points
     WHERE geom && !BBOX!
  """

  [[providers.layers]]
  name = "campaign_player_positions"
  geometry_fieldname = "geom"
  id_fieldname = "campaign_player_id"
  geometry_type = "Point"
  srid = 0
  sql = """
    SELECT campaign_player_id,
           campaign_id,
           user_id,
           character_id,
           role,
           visibility_state,
           last_located_at,
           geom
      FROM v_campaign_player_positions
     WHERE geom && !BBOX!
  """

  [[providers.layers]]
  name = "campaign_recent_trails"
  geometry_fieldname = "trail_geom"
  id_fieldname = "trail_id"
  geometry_type = "LineString"
  srid = 0
  sql = """
    SELECT
           ROW_NUMBER() OVER () AS trail_id,
           campaign_id,
           player_id,
           recorded_from,
           recorded_to,
           point_count,
           trail_geom
      FROM v_player_recent_trails
     WHERE trail_geom && !BBOX!
  """

  [[providers.layers]]
  name = "npc_positions"
  geometry_fieldname = "geom"
  id_fieldname = "npc_id"
  geometry_type = "Point"
  srid = 0
  sql = """
    SELECT id AS npc_id,
           campaign_id,
           name,
           occupation,
           geom
      FROM v_npc_world_positions
     WHERE geom && !BBOX!
  """

[[maps]]
name = "questables_world"
attribution = "Questables"

  [[maps.layers]]
  provider_layer = "questables.world_cells"
  name = "world_cells"
  min_zoom = 0
  max_zoom = {{TEGOLA_MAX_ZOOM}}

  [[maps.layers]]
  provider_layer = "questables.world_routes"
  name = "world_routes"
  min_zoom = 2
  max_zoom = {{TEGOLA_MAX_ZOOM}}

  [[maps.layers]]
  provider_layer = "questables.world_rivers"
  name = "world_rivers"
  min_zoom = 2
  max_zoom = {{TEGOLA_MAX_ZOOM}}

  [[maps.layers]]
  provider_layer = "questables.world_markers"
  name = "world_markers"
  min_zoom = 0
  max_zoom = {{TEGOLA_MAX_ZOOM}}

  [[maps.layers]]
  provider_layer = "questables.world_burgs"
  name = "world_burgs"
  min_zoom = 3
  max_zoom = {{TEGOLA_MAX_ZOOM}}

  [[maps.layers]]
  provider_layer = "questables.campaign_spawns"
  name = "campaign_spawns"
  min_zoom = 0
  max_zoom = {{TEGOLA_MAX_ZOOM}}

  [[maps.layers]]
  provider_layer = "questables.campaign_locations"
  name = "campaign_locations"
  min_zoom = 0
  max_zoom = {{TEGOLA_MAX_ZOOM}}

  [[maps.layers]]
  provider_layer = "questables.campaign_objectives"
  name = "campaign_objectives"
  min_zoom = 0
  max_zoom = {{TEGOLA_MAX_ZOOM}}

  [[maps.layers]]
  provider_layer = "questables.campaign_player_positions"
  name = "campaign_player_positions"
  min_zoom = 0
  max_zoom = {{TEGOLA_MAX_ZOOM}}

  [[maps.layers]]
  provider_layer = "questables.campaign_recent_trails"
  name = "campaign_recent_trails"
  min_zoom = 0
  max_zoom = {{TEGOLA_MAX_ZOOM}}

  [[maps.layers]]
  provider_layer = "questables.npc_positions"
  name = "npc_positions"
  min_zoom = 0
  max_zoom = {{TEGOLA_MAX_ZOOM}}
